name: Example - Deploy PostgreSQL with Users and Databases

on:
  workflow_dispatch:
    inputs:
      environment:
        description: 'Environment'
        required: true
        type: choice
        options:
          - test
          - prod
      instance_id:
        description: 'Linode Instance ID (optional)'
        required: false
        type: string

jobs:
  deploy-database:
    uses: ./.github/workflows/deploy-postgres.yml
    with:
      environment: ${{ inputs.environment }}
      region: us-east
      database_type: g6-dedicated-2
      engine_id: postgresql/18
      application_name: myapp
      instance_id: ${{ inputs.instance_id }}
      cluster_size: 1

      # Security settings
      ssl_connection: true
      encrypted: true

      # Create multiple databases
      databases: myapp_db,analytics_db,sessions_db

      # Service account username (default: srv_account)
      service_account_username: srv_account

    secrets:
      LINODE_TOKEN: ${{ secrets.LINODE_TOKEN }}
      DB_ROOT_PASSWORD: ${{ secrets.DB_ROOT_PASSWORD }}
      SERVICE_ACCOUNT_PASSWORD: ${{ secrets.SERVICE_ACCOUNT_PASSWORD }}
